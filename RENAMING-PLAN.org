#+TITLE: Renaming Plan: sage -> sage
#+AUTHOR: Claude Code
#+DATE: 2026-01-10

* Executive Summary

Rename the package from =sage= to =sage= (or alternative chosen name).

** Rationale
- Current name implies Gemini-only, but supports Gemini, OpenAI, and Ollama
- "Sage" evokes wisdom/advisor without provider lock-in
- Short, memorable, Emacs-friendly naming

** Scope
- 9 core Elisp modules (~1,400 symbol renames)
- 7 test files
- 8 example files
- 21 documentation files
- Storage paths and directory structure

* Naming Candidates

| Name | Prefix | Storage Dir | Buffer Name |
|------|--------|-------------|-------------|
| sage | sage- | ~/.emacs.d/sage/ | *sage* |
| aide | aide- | ~/.emacs.d/aide/ | *aide* |
| muse | muse- | ~/.emacs.d/muse/ | *muse* |
| llm-repl | llm-repl- | ~/.emacs.d/llm-repl/ | *llm-repl* |

*Recommended:* =sage= - short, evocative, no conflicts found

* File Renames

** Core Modules (9 files)

| Current | New |
|---------|-----|
| sage.el | sage.el |
| sage-context.el | sage-context.el |
| sage-emacs.el | sage-emacs.el |
| sage-memory.el | sage-memory.el |
| sage-project.el | sage-project.el |
| sage-queue.el | sage-queue.el |
| sage-ratelimit.el | sage-ratelimit.el |
| sage-session.el | sage-session.el |
| sage-tools.el | sage-tools.el |

** Test Files (10 files)

| Current | New |
|---------|-----|
| test/sage-test.el | test/sage-test.el |
| test/sage-context-test.el | test/sage-context-test.el |
| test/sage-emacs-test.el | test/sage-emacs-test.el |
| test/sage-memory-test.el | test/sage-memory-test.el |
| test/sage-project-test.el | test/sage-project-test.el |
| test/sage-queue-test.el | test/sage-queue-test.el |
| test/sage-ratelimit-test.el | test/sage-ratelimit-test.el |
| test-memory.el | (delete - duplicate) |
| test-session.el | (delete - duplicate) |
| test-tools.el | (delete - duplicate) |

** Example Files (8 files)

| Current | New |
|---------|-----|
| examples/init-example.el | examples/init-example.el |
| examples/context-example.el | examples/context-example.el |
| examples/memory-usage.el | examples/memory-usage.el |
| examples/project-sessions-example.el | examples/project-sessions-example.el |
| examples/queue-demo.el | examples/queue-demo.el |
| examples/ratelimit-demo.el | examples/ratelimit-demo.el |
| examples/multi-agent-workflow.el | examples/multi-agent-workflow.el |
| examples/usage-guide.org | examples/usage-guide.org |

(Names stay same, contents updated)

* Symbol Renames

** Scope by Module

| Module | Occurrences | Key Symbols |
|--------|-------------|-------------|
| sage.el | 292 | sage, sage-provider, sage-mode |
| sage-project.el | 162 | sage-project-*, --current-conversation |
| sage-session.el | 148 | sage-session-*, --current |
| sage-emacs.el | 141 | sage-emacs-*, org functions |
| sage-queue.el | 139 | sage-queue-*, --input-dir |
| sage-context.el | 139 | sage-context-*, token functions |
| sage-tools.el | 122 | sage-tools-*, register-tool |
| sage-memory.el | 93 | sage-memory-*, --facts |
| sage-ratelimit.el | 72 | sage-ratelimit-*, --limits |

*Total: ~1,308 symbol occurrences in core modules*

** Key Public API Renames

*** Core Functions
| Current | New |
|---------|-----|
| sage | sage |
| sage-exec | sage-exec |
| sage-send-region | sage-send-region |
| sage-register-tool | sage-register-tool |
| sage-mode | sage-mode |
| global-sage-mode | global-sage-mode |

*** Variables
| Current | New |
|---------|-----|
| sage-provider | sage-provider |
| sage-model | sage-model |
| sage-api-key | sage-gemini-api-key |
| sage-openai-api-key | sage-openai-api-key |
| sage-ollama-host | sage-ollama-host |
| sage-workspace | sage-workspace |
| sage-yolo-mode | sage-yolo-mode |
| sage-max-tool-iterations | sage-max-tool-iterations |

*** Buffer Names
| Current | New |
|---------|-----|
| *sage* | *sage* |
| *Sage Memory* | *Sage Memory* |
| *Sage Sessions* | *Sage Sessions* |

*** Customization Groups
| Current | New |
|---------|-----|
| sage | sage |
| sage-tools | sage-tools |
| sage-session | sage-session |
| sage-memory | sage-memory |
| sage-context | sage-context |
| sage-queue | sage-queue |
| sage-ratelimit | sage-ratelimit |
| sage-emacs | sage-emacs |
| sage-project | sage-project |

* Storage Paths

** Directory Structure

| Current | New |
|---------|-----|
| ~/.emacs.d/sage/ | ~/.emacs.d/sage/ |
| ~/.emacs.d/sage/sessions/ | ~/.emacs.d/sage/sessions/ |
| ~/.emacs.d/sage/projects/ | ~/.emacs.d/sage/projects/ |
| ~/.emacs.d/sage/memory/ | ~/.emacs.d/sage/memory/ |
| ~/.emacs.d/sage/queues/ | ~/.emacs.d/sage/queues/ |

** History File
| Current | New |
|---------|-----|
| ~/.emacs.d/sage-history | ~/.emacs.d/sage-history |

* Documentation Updates

** Files to Update (21 total)

*** High Priority (README & Core)
| File | Occurrences |
|------|-------------|
| README.org | 91 |
| API-REFERENCE.org | 85 |
| .claude/CLAUDE.md | 10 |

*** Feature Documentation
| File | Occurrences |
|------|-------------|
| QUEUE.org | 67 |
| CONTEXT.md | 63 |
| PROJECT-SESSIONS.org | 62 |
| SESSION-USAGE.md | 60 |
| QUEUE-QUICKSTART.md | 53 |
| MEMORY.org | 51 |
| INTEGRATION-SUMMARY.org | 46 |
| TOOLS-SUMMARY.md | 43 |
| CHANGES.md | 42 |
| QUICKSTART-project-sessions.org | 36 |
| EMACS-INTEGRATION.md | 32 |
| CHANGELOG-project-sessions.org | 32 |
| RATELIMITING.org | 31 |
| QUEUE-IMPLEMENTATION-SUMMARY.md | 31 |
| README-TOOLS.md | 20 |
| RATELIMIT-IMPLEMENTATION.org | 20 |
| TOOLS-QUICK-REF.org | 14 |
| SLASH-COMMANDS.md | 3 |

*Total: ~889 occurrences in documentation*

* Implementation Steps

** Phase 1: Preparation
1. [ ] Create git branch: =rename/sage=
2. [ ] Backup current state
3. [ ] Verify all tests pass before changes

** Phase 2: Core Module Renames (Automated)
1. [ ] Rename files: sage*.el -> sage*.el
2. [ ] Global replace in .el files: =sage= -> =sage=
3. [ ] Update require/provide statements
4. [ ] Update defgroup definitions
5. [ ] Verify byte-compilation

** Phase 3: Test File Updates
1. [ ] Rename test files
2. [ ] Update test require statements
3. [ ] Update test function names
4. [ ] Run tests to verify

** Phase 4: Example Updates
1. [ ] Update all example files
2. [ ] Update usage-guide.org
3. [ ] Verify examples still work

** Phase 5: Documentation Updates
1. [ ] Update README.org
2. [ ] Update API-REFERENCE.org
3. [ ] Update all feature docs
4. [ ] Update .claude/CLAUDE.md

** Phase 6: Project Configuration
1. [ ] Update Makefile
2. [ ] Update Cask
3. [ ] Update .dir-locals.el
4. [ ] Update beads issues (re-label)

** Phase 7: Repository Rename
1. [ ] Create new repo: aygp-dr/sage.el (or sage-emacs)
2. [ ] Update git remote
3. [ ] Archive sage-010

** Phase 8: Verification
1. [ ] Full test suite passes
2. [ ] Byte-compilation clean
3. [ ] Manual REPL testing
4. [ ] Documentation review

* Automation Script

#+begin_src bash
#!/bin/bash
# rename-to-sage.sh - Automate the renaming process

OLD="sage"
NEW="sage"

# Phase 2: Rename core files
for f in ${OLD}*.el; do
    newname="${f/${OLD}/${NEW}}"
    git mv "$f" "$newname"
done

# Phase 2: Rename test files
for f in test/${OLD}*.el; do
    newname="${f/${OLD}/${NEW}}"
    git mv "$f" "$newname"
done

# Phase 2: Global symbol replacement
for f in *.el test/*.el examples/*.el; do
    sed -i '' "s/${OLD}/${NEW}/g" "$f"
done

# Phase 5: Documentation updates
for f in *.org *.md .claude/CLAUDE.md; do
    sed -i '' "s/${OLD}/${NEW}/g" "$f"
    sed -i '' "s/Sage/Sage/g" "$f"
done

# Phase 6: Config updates
sed -i '' "s/${OLD}/${NEW}/g" Makefile Cask .dir-locals.el
#+end_src

* Backward Compatibility

** Aliases (Optional)
Provide aliases for transition period:

#+begin_src elisp
;; In sage.el - backward compatibility aliases
(define-obsolete-function-alias 'sage 'sage "1.0")
(define-obsolete-function-alias 'sage-exec 'sage-exec "1.0")
(define-obsolete-variable-alias 'sage-provider 'sage-provider "1.0")
;; ... etc
#+end_src

** Migration Guide
Create MIGRATION.org with:
- API mapping table
- Configuration migration steps
- Storage path migration script

* Risk Assessment

| Risk | Impact | Mitigation |
|------|--------|------------|
| Broken requires | High | Careful testing after each phase |
| Symbol conflicts | Medium | Check MELPA/ELPA for "sage" conflicts |
| Storage migration | Low | Document manual migration steps |
| Bookmark/history loss | Low | Provide migration script |

* Timeline Estimate

| Phase | Effort |
|-------|--------|
| Preparation | 10 min |
| Core modules | 30 min |
| Tests | 15 min |
| Examples | 10 min |
| Documentation | 45 min |
| Configuration | 10 min |
| Verification | 30 min |
| *Total* | *~2.5 hours* |

* Next Steps

1. Confirm name choice: =sage= vs alternatives
2. Create feature branch
3. Run automated rename script
4. Manual verification and fixes
5. Update beads with new prefix
6. Create PR for review

* Appendix: Full Symbol Inventory

** Top 40 Symbols to Rename

| Count | Symbol |
|-------|--------|
| 89 | sage |
| 30 | sage-conversation |
| 26 | sage-tools |
| 24 | sage-project--current-conversation |
| 23 | sage-tools--register |
| 22 | sage-session--current |
| 22 | sage-buffer-name |
| 20 | sage-project--current-metadata |
| 19 | sage-memory--facts |
| 18 | sage-send-input |
| 17 | sage-memory |
| 16 | sage-tools--get-workspace |
| 16 | sage--insert |
| 16 | sage--get-workspace |
| 15 | sage-project-dir |
| 14 | sage-provider |
| 13 | sage-context |
| 12 | sage-emacs |
| 12 | sage--get-model |
| 11 | sage-session |
| 11 | sage-register-tool |
| 11 | sage-mode |
| 10 | sage-token-count |
| 10 | sage-queue--input-dir |
| 10 | sage-queue |
| 10 | sage-project |
| 9 | sage-session-name |
| 9 | sage-current-session |
| 8 | sage-session-messages |
| 8 | sage-session-message-count |
| 8 | sage-ratelimit--limits |
| 8 | sage-ratelimit |
| 8 | sage-queue--ensure-directories |
| 8 | sage-project--conversation-file |
| 8 | sage-last-response |
| 8 | sage--request |
| 7 | sage-sessions |
| 7 | sage-session--auto-save-timer |
| 7 | sage-queue--watch-descriptor |
| 7 | sage-queue--stats |
